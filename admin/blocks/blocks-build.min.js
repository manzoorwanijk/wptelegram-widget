!function(n){var r={};function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=3)}([function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);n(0);var s=wp.element.createElement,c=wp.i18n.__,r=wp.blocks.registerBlockType,p=wp.editor.InspectorControls,o=wp.components,f=o.PanelBody,g=o.TextControl,d=o.Dashicon,m=function(t){var e=["widget_width","widget_height"].filter(function(e){return t[e]}).map(function(e){return"".concat(e,'="').concat(t[e],'"')}),n="[wptelegram-ajax-widget";return e.length&&(n+=" "+e.join(" ")),n+="]"};r("wptelegram/widget-ajax-channel-feed",{title:c("Telegram Channel Ajax Feed"),icon:"format-aside",category:"widgets",attributes:{widget_width:{type:"string",default:"100%"},widget_height:{type:"string",default:"600"}},edit:function(e){var t=e.attributes,n=e.setAttributes,r=e.className,o=t.widget_width,i=t.widget_height,a=[s(p,null,s(f,{title:c("Widget Options")},s(g,{label:c("Widget Width"),value:o,onChange:function(e){return n({widget_width:e})}}),s(g,{label:c("Widget Height"),value:i,onChange:function(e){return n({widget_height:e})},type:"number"})))],l=s("label",null,s(d,{icon:"shortcode"}),s("span",null,c("Telegram Channel Ajax Feed"))),u=m(t);return[a,s("div",{className:r},l,s("code",{className:"widget-shortcode"},u))]},save:function(e){var t=e.attributes,n=m(t);return s("div",null,n)}});n(1);var h=wp.element.createElement,w=wp.i18n.__,i=wp.blocks.registerBlockType,b=wp.editor.InspectorControls,a=wp.components,y=a.PanelBody,_=a.RadioControl,v=a.TextControl,S=a.Dashicon;i("wptelegram/widget-channel-feed",{title:w("Telegram Channel Feed"),icon:"format-aside",category:"widgets",attributes:{widget_width:{type:"string",default:"100"},author_photo:{type:"string",default:"auto"},num_messages:{type:"string",default:"5"}},edit:function(e){var t=e.attributes,n=e.setAttributes,r=e.className,o=t.widget_width,i=t.author_photo,a=t.num_messages,l=[h(b,null,h(y,{title:w("Widget Options")},h(v,{label:w("Widget Width"),value:o,onChange:function(e){return n({widget_width:e})},type:"number",min:"10",max:"100"}),h(_,{label:w("Author Photo"),selected:i,onChange:function(e){return n({author_photo:e})},options:[{label:"Auto",value:"auto"},{label:"Always show",value:"always_show"},{label:"Always hide",value:"always_hide"}]}),h(v,{label:w("Number of Messages"),value:a,onChange:function(e){return n({num_messages:e})},type:"number",min:"1",max:"50"})))],u=h("label",null,h(S,{icon:"shortcode"}),h("span",null,w("Telegram Channel Feed"))),s="[wptelegram-widget";return s+=t.widget_width?' widget_width="'.concat(t.widget_width,'"'):"",s+=' author_photo="'.concat(t.author_photo,'" num_messages="').concat(t.num_messages,'"]'),[l,h("div",{className:r},u,h("code",{className:"widget-shortcode"},s))]},save:function(e){var t=e.attributes,n=t.widget_width,r=t.author_photo,o=t.num_messages,i='[wptelegram-widget author_photo="'.concat(r,'" num_messages="').concat(o,'"');return i+=n?' widget_width="'.concat(n,'"]'):"]",h("div",null,i)}});n(2);var l=wp.element.createElement,u=wp.i18n.__,k=wp.components,T=k.Button,C=k.Placeholder,P=function(e){var t=e.label,n=e.url,r=e.onSubmit,o=e.onChangeURL,i=e.error;return l(C,{icon:"wordpress-alt",label:t,className:"wp-block-embed-telegram"},l("form",{onSubmit:r},l("input",{style:i?{border:"2px solid #f71717"}:{},type:"url",value:n||"",className:"components-placeholder__input","aria-label":t,placeholder:"https://t.me/WPTelegram/102",onChange:o}),l(T,{isLarge:!0,type:"submit"},u("Embed"))))},R=wp.element.createElement,U=wp.i18n.__,O=wp.element.Fragment,j=wp.editor,x=j.InspectorControls,B=j.BlockControls,I=j.BlockAlignmentToolbar,E=wp.components,L=E.PanelBody,N=E.IconButton,A=E.Toolbar,W=(E.TextControl,E.ToggleControl),z=function(e){var t=e.userpic,n=e.toggleUserPic,r=e.showEditButton,o=e.switchBackToURLInput,i=e.alignment,a=e.changeAlignment;return R(O,null,R(x,null,R(L,{title:U("Options")},R(W,{label:U("Author Photo"),checked:t,onChange:n}))),R(B,null,R(I,{value:i,onChange:a}),R(A,null,r&&R(N,{className:"components-toolbar__control",label:U("Edit URL"),icon:"edit",onClick:o}))))};function F(e){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function M(e,t){M=function(e,t){return new n(e,t)};var r=D(RegExp),o=RegExp.prototype,i=new WeakMap;function n(e,t){var n=r.call(this,e);return i.set(n,t),n}function a(n,e){var r=i.get(e);return Object.keys(r).reduce(function(e,t){return e[t]=n[r[t]],e},Object.create(null))}return q(n,r),n.prototype.exec=function(e){var t=o.exec.call(this,e);return t&&(t.groups=a(t,this)),t},n.prototype[Symbol.replace]=function(e,t){if("string"==typeof t){var n=i.get(this);return o[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,function(e,t){return"$"+n[t]}))}if("function"!=typeof t)return o[Symbol.replace].call(this,e,t);var r=this;return o[Symbol.replace].call(this,e,function(){var e=[];return e.push.apply(e,arguments),"object"!==F(e[e.length-1])&&e.push(a(e,r)),t.apply(this,e)})},M.apply(this,arguments)}function D(e){var n="function"==typeof Map?new Map:void 0;return(D=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return $(e,arguments,Y(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),G(t,e)})(e)}function $(e,t,n){return($=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&G(o,n.prototype),o}).apply(null,arguments)}function H(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Y(e){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function q(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&G(e,t)}function G(e,t){return(G=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var J=wp.element.createElement,K=wp.element,V=K.Component,X=K.Fragment,Z=K.createRef,ee=wp.i18n.__,te=wp.components,ne=te.FocusableIframe,re=te.Spinner,oe=window.wptelegram_widget.blocks.assets.message_view_url,ie=wp.url.addQueryArgs,ae=function(e){function t(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(e=function(e,t){return!t||"object"!==F(t)&&"function"!=typeof t?Q(e):t}(this,Y(t).apply(this,arguments))).iframe_ref=Z(),e.switchBackToURLInput=e.switchBackToURLInput.bind(Q(e)),e.getIframeSrc=e.getIframeSrc.bind(Q(e)),e.toggleUserPic=e.toggleUserPic.bind(Q(e)),e.resizeIframe=e.resizeIframe.bind(Q(e)),e.setUrl=e.setUrl.bind(Q(e)),e.state={loading:!0,editingURL:!1,error:!1,url:e.props.attributes.url,userpic:e.props.attributes.userpic,iframe_height:null},e}return q(t,V),function(e,t,n){t&&H(e.prototype,t),n&&H(e,n)}(t,[{key:"toggleUserPic",value:function(){var e=!this.state.userpic,t=this.props.attributes.iframe_src;t=ie(t,{userpic:e}),this.setState({userpic:e,loading:!0}),this.props.setAttributes({userpic:e,iframe_src:t})}},{key:"setUrl",value:function(e){e&&e.preventDefault();var t=this.state.url,n=M(/^(?:https?:\/\/)?t\.me\/([a-z][a-z0-9_]{3,30}[a-z0-9])\/(\d+)$/i,{username:1,message_id:2}),r=t.match(n);if(null===r)this.setState({error:!0});else{var o=this.getIframeSrc(r.groups),i=this.props.setAttributes;this.setState({loading:!0,editingURL:!1,error:!1}),i({url:t,iframe_src:o})}}},{key:"getIframeSrc",value:function(e){return oe.replace("%username%",e.username).replace("%message_id%",e.message_id).replace("%userpic%",this.state.userpic)}},{key:"switchBackToURLInput",value:function(){this.setState({editingURL:!0})}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.resizeIframe)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.resizeIframe)}},{key:"resizeIframe",value:function(){if(null!==this.iframe_ref.current&&void 0!==this.iframe_ref.current.contentWindow){var e=this.iframe_ref.current.contentWindow.document.body.scrollHeight;console.log(e),e!==this.state.iframe_height&&this.setState({iframe_height:e})}}},{key:"render",value:function(){var t=this,e=this.state,n=e.loading,r=e.editingURL,o=e.url,i=e.error,a=e.userpic,l=this.props,u=l.className,s=l.setAttributes,c=this.props.attributes,p=c.alignment,f=c.iframe_src,g=ee("Telegram post URL");if(r||!f)return J(P,{label:g,error:i,url:o,onChangeURL:function(e){return t.setState({url:e.target.value})},onSubmit:this.setUrl});var d=n?0:this.state.iframe_height;return J(X,null,J(z,{userpic:a,toggleUserPic:this.toggleUserPic,showEditButton:!0,switchBackToURLInput:this.switchBackToURLInput,alignment:p,changeAlignment:function(e){t.resizeIframe(),s({alignment:e})}}),n&&J("div",{className:"wp-block-embed is-loading"},J(re,null),J("p",null,ee("Loading…"))),J("div",{className:u+" wptelegram-widget-message"},J("div",{className:"wp-block-embed__content-wrapper"},J(ne,{iframeRef:this.iframe_ref,frameBorder:"0",scrolling:"no",src:f,onLoad:function(){t.setState({loading:!1}),t.resizeIframe()},height:d},"Your Browser Does Not Support iframes!"))))}}]),t}(),le=wp.element.createElement,ue=wp.i18n.__;(0,wp.blocks.registerBlockType)("wptelegram/widget-single-post",{title:ue("Telegram Single Post"),icon:"format-aside",category:"widgets",getEditWrapperProps:function(e){var t=e.alignment;if(["left","center","right","wide","full"].includes(t))return{"data-align":t}},attributes:{url:{type:"string",default:""},iframe_src:{type:"string",default:""},userpic:{type:"boolean",default:!0},alignment:{type:"string",default:"center"}},edit:ae,save:function(e){var t=e.attributes,n=t.alignment,r=t.iframe_src;return le("div",{className:"wp-block-wptelegram-widget-single-post wptelegram-widget-message align"+n},le("iframe",{frameBorder:"0",scrolling:"no",src:r},"Your Browser Does Not Support iframes!"))}})}]);